package test.liuzehua.securitydemo.controller;import com.google.code.kaptcha.impl.DefaultKaptcha;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.http.MediaType;import org.springframework.web.bind.annotation.*;import test.liuzehua.securitydemo.service.ImageService;import javax.imageio.ImageIO;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpSession;import java.awt.image.BufferedImage;import java.io.*;/** * @author liuzehua * 2020/5/28 **/@RestController@CrossOriginpublic class ImageController {    @Autowired    ImageService imageService;    @Autowired    private DefaultKaptcha defaultKaptcha;    @GetMapping(value = "/getPictureCode", produces = MediaType.APPLICATION_JSON_VALUE)    public String getPictureCode(HttpServletRequest request){        String param = "ImgVerificationCodeMark";        String PictureCode = imageService.createPicVerificationCode(param, request);        return PictureCode;    }    @GetMapping(value = "/getCode")    public String getCode(HttpServletRequest request){        String param = "ImgVerificationCodeMark";        HttpSession session = request.getSession();        String code = (String) session.getAttribute(param);        session.removeAttribute(param);        return code;    }    @GetMapping(value = "/getImage")    public void getImage(HttpServletRequest request, HttpServletResponse response) throws IOException {        String param = "ImgVerificationCodeMark";        String verificationCodeText = defaultKaptcha.createText();        //加入到session方便后面验证        request.getSession().setAttribute(param,verificationCodeText);        BufferedImage image = defaultKaptcha.createImage(verificationCodeText);        response.setContentType("image/jpg");        ImageIO.write(image,"jpg",response.getOutputStream());    }}